# Configuration file for RTI-VIPS installer.

{
  "dependencies" : {

    "git" : {

      "label" : "Git",

      "type" : "confirmation",

      "checkCommand" : {
        "command" : "git --version",
        "directory" : "$HOME"
      }
    },

    "brew" : {

      "checkCommand" : {
        "directory" : "$HOME",
        "command" : "homebrew/bin/brew --version"
      },

      "downloads" : [ 
        {
          "label" : "Homebrew",
          "url"   : "https://github.com/Homebrew/homebrew/tarball/master",
          "local" : "Resources/Java/files/homebrew.tgz"
        }
      ],

      "installCommands" : [

        {
          "directory" : "$HOME",
          "command" : "mkdir homebrew"
        },

        {
          "directory" : "$HOME",
          "command" : "tar xzf $CWD/Resources/Java/files/homebrew.tgz --strip 1 -C homebrew"
        }
      ]
    },

    "libgphoto2" : {

      "checkCommand" : {
        "directory" : "$HOME",
        "command" : "ls homebrew/lib/libgphoto2.dylib"
      },

      "installCommands" : [
        {
          "label"   : "libgphoto2",
          "directory" : "$HOME",
          "command" : "homebrew/bin/brew install libgphoto2"
        }
      ]
    },

    "python" : {

      "checkCommand" : {
        "directory" : "$HOME",
        "command" : "ls homebrew/bin/python"
      },

      "installCommands" : [
        {
          "label"   : "python",
          "directory" : "$HOME",
          "command" : "homebrew/bin/brew install python"
        }
      ]
    },

    "pygtk" : {

      "checkCommand" : {
        "directory" : "$HOME",
        "command" : "ls homebrew/lib/pygtk"
      },

      "installCommands" : [
        {
          "label"   : "pygtk",
          "directory" : "$HOME",
          "command" : "homebrew/bin/brew install pygtk",
          "pathExtra" : "$CWD/PlugIns/JRE/Contents/Home/bin"
        }
      ]
    },

    "pyserial" : {

      "checkCommand" : {
        "directory" : "$HOME",
        "command" : "ls homebrew/lib/python2.7/site-packages/pyserial-2.7.dist-info/metadata.json"
      },

      "installCommands" : [
        {
          "label"   : "pyserial",
          "directory" : "$HOME",
          "command" : "homebrew/bin/pip install pyserial"
        }
      ]
    },

    "autoconf" : {

      "checkCommand" : {
        "directory" : "$HOME",
        "command" : "ls homebrew/bin/autoconf"
      },

      "installCommands" : [
        {
          "label"   : "Installing autoconf",
          "directory" : "$HOME",
          "command" : "homebrew/bin/brew install autoconf"
        }
      ]
    },

    "automake" : {

      "checkCommand" : {
        "directory" : "$HOME",
        "command" : "ls homebrew/bin/automake"
      },

      "installCommands" : [
        {
          "label"   : "Installing automake",
          "directory" : "$HOME",
          "command" : "homebrew/bin/brew install automake"
        }
      ]
    },

    "vips" : {

      "checkCommand" : {
        "directory" : "$HOME",
        "command" : "ls homebrew/lib/libvips.dylib"
      },

      "installCommands" : [
        {
          "label"   : "Installing VIPS",
          "directory" : "$HOME",
          "command" : "homebrew/bin/brew install homebrew/science/vips"
        }
      ]
    }
  },

  "options" : [

    {
      "label" : "RTI Viewer",

      "commands" : [

        {
          "directory" : "$HOME",
          "command" : "mkdir -p mountpoint",

          "cleanup" : [
            {
              "directory" : "$HOME",
              "command" : "rmdir mountpoint"
            }
          ]
        },

        {
          "directory" : "$HOME",
          "command" : "hdiutil attach -mountpoint mountpoint $CWD/Resources/Java/files/RTIViewer-1.1.0.dmg",

          "cleanup" : [
            {
              "directory" : "$HOME",
              "command" : "hdiutil detach mountpoint"
            }
          ]
        },

        {
          "directory" : "$HOME",
          "command" : "cp -r mountpoint/RTIViewer.app /Applications"
        }
      ]
    },

    {
      "label" : "RTI Builder",

      "commands" : [

        {
          "directory" : "$HOME",
          "command" : "mkdir -p mountpoint",

          "cleanup" : [
            {
              "directory" : "$HOME",
              "command" : "rmdir mountpoint"
            }
          ]
        },

        {
          "directory" : "$HOME",
          "command" : "hdiutil attach -mountpoint mountpoint $CWD/Resources/Java/files/RTIbuilder_2_0_2.dmg",

          "cleanup" : [
            {
              "directory" : "$HOME",
              "command" : "hdiutil detach mountpoint"
            }
          ]
        },

        {
          "directory" : "$HOME",
          "command" : "cp -r mountpoint/RTIbuilder-v2.0.2.app /Applications"
        }
      ]
    },

    {
      "label" : "RTI Capture",

      "dependencies" : [ "brew", "git", "libgphoto2", "python", "pygtk", "pyserial" ],

      "commands" : [

        {
          "directory" : "$HOME",
          "command" : "rm -rf .installer_temp"
        },

        {
          "directory" : "$HOME",
          "command" : "mkdir .installer_temp"
        },

        {
          "directory" : "$HOME/.installer_temp",
          "command" : "git clone https://github.com/rti-capture/rtiacquire",
          "label" : "Fetching RTI Acquire",
          "pathExtra" : "$HOME/homebrew/bin"
        },

        {
          "directory" : "$HOME/.installer_temp/rtiacquire",
          "command" : "python setup.py build",
          "label" : "Building RTI Acquire",
          "pathExtra" : "$HOME/homebrew/bin"
        },

        {
          "directory" : "$HOME/.installer_temp/rtiacquire",
          "command" : "python setup.py install",
          "label" : "Installing RTI Acquire",
          "pathExtra" : "$HOME/homebrew/bin"
        }
      ]
    },

    {
      "label" : "PTM Fit",

      "dependencies" : [ "brew", "autoconf", "automake", "vips" ],

      "commands" : [

        {
          "directory" : "$HOME",
          "command" : "rm -rf .installer_temp"
        },

        {
          "directory" : "$HOME",
          "command" : "mkdir .installer_temp",

          "cleanup" : [
            {
              "directory" : "$HOME",
              "command" : "rm -rf .installer_temp"
            }
          ]
        },

        {
          "directory" : "$HOME/.installer_temp",
          "command" : "tar xzf $CWD/Resources/Java/files/ptmfit-2.3.tgz",
          "label" : "Fetching PTM Fit"
        },

        {
          "directory" : "$HOME/.installer_temp/ptmfit-2.3",
          "command" : "sh bootstrap.sh",
          "label" : "Running bootstrap for PTM Fit",
          "pathExtra" : "$HOME/homebrew/bin"
        },

        {
          "directory" : "$HOME/.installer_temp/ptmfit-2.3",
          "command" : "sh configure --prefix $HOME/homebrew",
          "label" : "Configuring PTM Fit",
          "pathExtra" : "$HOME/homebrew/bin"
        },

        {
          "directory" : "$HOME/.installer_temp/ptmfit-2.3",
          "command" : "make",
          "label" : "Building PTM Fit",
          "pathExtra" : "$HOME/homebrew/bin"
        },

        {
          "directory" : "$HOME/.installer_temp/ptmfit-2.3",
          "command" : "make install",
          "label" : "Installing PTM Fit",
          "pathExtra" : "$HOME/homebrew/bin"
        }
      ]
    }
  ]
}
