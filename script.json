# Configuration file for RTI-VIPS installer.

{
  "dependencies" : {

    "commandLineTools" : {

      "label" : "Command Line Tools",

      "checkCommand" : {
        "command" : "$CWD/Resources/check_command_line_tools.sh"
      },

      "installCommands" : [

        {
          "label" : "Installing Command Line Tools",
          "directory" : "$CWD",
          "command" : "Resources/install_command_line_tools.sh"
        }
      ]
    },

    "brew" : {

      "label" : "Brew",

      "checkCommand" : {
        "directory" : "$CWD",
        "command" : "Resources/checkBrew.sh"
      },

      "installCommands" : [

        {
          "label" : "Installing Brew",
          "directory" : "$CWD",
          "command" : "Resources/InstallBrew.sh"
        }
      ]
    },

    "libgphoto2" : {

      "checkCommand" : {
        "directory" : "$HOME",
        "command" : "ls homebrew/lib/libgphoto2.dylib"
      },

      "installCommands" : [
        {
          "label"   : "libgphoto2",
          "directory" : "$HOME",
          "command" : "homebrew/bin/brew install libgphoto2"
        }
      ]
    },

    "python" : {

      "checkCommand" : {
        "directory" : "$HOME",
        "command" : "ls homebrew/bin/python"
      },

      "installCommands" : [
        {
          "label"   : "python",
          "directory" : "$HOME",
          "command" : "homebrew/bin/brew install python"
        }
      ]
    },

    "pygtk" : {

      "checkCommand" : {
        "directory" : "$HOME",
        "command" : "ls homebrew/lib/pygtk"
      },

      "installCommands" : [
        {
          "label"   : "pygtk",
          "directory" : "$HOME",
          "command" : "homebrew/bin/brew install pygtk",
          "pathExtra" : "$CWD/PlugIns/JRE/Contents/Home/bin"
        }
      ]
    },

    "pyserial" : {

      "checkCommand" : {
        "directory" : "$HOME",
        "command" : "ls homebrew/lib/python2.7/site-packages/pyserial-2.7.dist-info/metadata.json"
      },

      "installCommands" : [
        {
          "label"   : "pyserial",
          "directory" : "$HOME",
          "command" : "homebrew/bin/pip install pyserial"
        }
      ]
    },

    "autoconf" : {

      "checkCommand" : {
        "directory" : "$CWD",
        "command" : "Resources/brew.sh list autoconf"
      },

      "installCommands" : [
        {
          "label"   : "Installing autoconf",
          "directory" : "$CWD",
          "command" : "Resources/brew.sh install autoconf"
        }
      ]
    },

    "automake" : {

      "checkCommand" : {
        "directory" : "$CWD",
        "command" : "Resources/brew.sh list automake"
      },

      "installCommands" : [
        {
          "label"   : "Installing automake",
          "directory" : "$CWD",
          "command" : "Resources/brew.sh install automake"
        }
      ]
    },

    "vips" : {

      "checkCommand" : {
        "directory" : "$CWD",
        "command" : "Resources/brew.sh list vips"
      },

      "installCommands" : [
        {
          "label"   : "Installing VIPS",
          "directory" : "$CWD",
          "command" : "Resources/brew.sh install homebrew/science/vips"
        }
      ]
    }
  },

  "options" : [

    {
      "label" : "RTI Viewer",

      "commands" : [

        {
          "directory" : "$HOME",
          "command" : "mkdir -p mountpoint",

          "cleanup" : [
            {
              "directory" : "$HOME",
              "command" : "rmdir mountpoint"
            }
          ]
        },

        {
          "directory" : "$HOME",
          "command" : "hdiutil attach -mountpoint mountpoint $CWD/Resources/Java/files/RTIViewer-1.1.0.dmg",

          "cleanup" : [
            {
              "directory" : "$HOME",
              "command" : "hdiutil detach mountpoint"
            }
          ]
        },

        {
          "directory" : "$HOME",
          "command" : "$CWD/Resources/sudo.sh cp -r mountpoint/RTIViewer.app /Applications"
        }
      ]
    },

    {
      "label" : "RTI Builder",

      "commands" : [

        {
          "directory" : "$HOME",
          "command" : "mkdir -p mountpoint",

          "cleanup" : [
            {
              "directory" : "$HOME",
              "command" : "rmdir mountpoint"
            }
          ]
        },

        {
          "directory" : "$HOME",
          "command" : "hdiutil attach -mountpoint mountpoint $CWD/Resources/Java/files/RTIbuilder_2_0_2.dmg",

          "cleanup" : [
            {
              "directory" : "$HOME",
              "command" : "hdiutil detach mountpoint"
            }
          ]
        },

        {
          "directory" : "$HOME",
          "command" : "$CWD/Resources/sudo.sh cp -r mountpoint/RTIbuilder-v2.0.2.app /Applications"
        }
      ]
    },

    {
      "label" : "RTI Capture",

      "dependencies" : [ "commandLineTools", "brew", "libgphoto2", "python", "pygtk", "pyserial" ],

      "commands" : [

        {
          "directory" : "$HOME",
          "command" : "rm -rf .installer_temp"
        },

        {
          "directory" : "$HOME",
          "command" : "mkdir .installer_temp"
        },

        {
          "directory" : "$HOME/.installer_temp",
          "command" : "git clone https://github.com/rti-capture/rtiacquire",
          "label" : "Fetching RTI Acquire",
          "pathExtra" : "$HOME/homebrew/bin"
        },

        {
          "directory" : "$HOME/.installer_temp/rtiacquire",
          "command" : "python setup.py build",
          "label" : "Building RTI Acquire",
          "pathExtra" : "$HOME/homebrew/bin"
        },

        {
          "directory" : "$HOME/.installer_temp/rtiacquire",
          "command" : "python setup.py install",
          "label" : "Installing RTI Acquire",
          "pathExtra" : "$HOME/homebrew/bin"
        }
      ]
    },

    {
      "label" : "PTM Fit",

      "dependencies" : [ "commandLineTools", "brew", "autoconf", "automake", "vips" ],

      "commands" : [

        {
          "directory" : "$HOME",
          "command" : "rm -rf .installer_temp"
        },

        {
          "directory" : "$HOME",
          "command" : "mkdir .installer_temp",

          "cleanup" : [
            {
              "directory" : "$HOME",
              "command" : "rm -rf .installer_temp"
            }
          ]
        },

        {
          "directory" : "$HOME/.installer_temp",
          "command" : "tar xzf $CWD/Resources/Java/files/ptmfit-2.3.tgz",
          "label" : "Extracting PTM Fit"
        },

        {
          "directory" : "$HOME/.installer_temp/ptmfit-2.3",
          "command" : "sh bootstrap.sh",
          "label" : "Running bootstrap for PTM Fit"
        },

        {
          "directory" : "$HOME/.installer_temp/ptmfit-2.3",
          "command" : "sh configure",
          "label" : "Configuring PTM Fit"
        },

        {
          "directory" : "$HOME/.installer_temp/ptmfit-2.3",
          "command" : "make",
          "label" : "Building PTM Fit"
        },

        {
          "directory" : "$HOME/.installer_temp/ptmfit-2.3",
          "command" : "$CWD/Resources/sudo.sh make install",
          "label" : "Installing PTM Fit"
        }
      ]
    },
    
    {
      "label" : "Test",

      "dependencies" : [ "commandLineTools", "brew" ],

      "commands" : [

        {
          "command" : "echo Finished"
        }
      ]
    }
  ]
}
